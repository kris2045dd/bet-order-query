!function(){var e=!1;$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},beforeSend:function(){e=!0},error:function(e){"419"==e.status?confirm("Session 已失效，请重新整理页面.")&&location.reload():alert("发生错误.")},complete:function(t,n){e=!1}});var t=angular.module("jsApp",["ui.bootstrap"]);t.config(["$interpolateProvider",function(e){e.startSymbol("{*"),e.endSymbol("*}")}]),t.filter("offset",function(){return function(e,t){return t=parseInt(t,10),e.slice(t)}}),t.filter("tailNo",function(){return function(e,t){if(""==t)return e;for(var n=[],o=0,r=e.length,a=new RegExp(t+"$");o<r;o++){var i=e[o];a.test(i.bet_order_id)&&n.push(i)}return n}}),t.filter("amountGreaterThan",function(){return function(e,t){if(isNaN(t)||""==t)return e;for(var n=[],o=0,r=e.length;o<r;o++){var a=e[o];a.bet_amount>=t&&n.push(a)}return n}}),t.controller("BodyCtrl",["$scope","$http","tailNoFilter","amountGreaterThanFilter","username","BASE_URI",function(t,n,o,r,a,i){var u=this;function c(){var e=o(u.bet_orders,u.qs.tail_no);e=r(e,u.qs.amount),u.filtered_bet_orders=e}u.username=a,u.bet_orders=[],u.filtered_bet_orders=[],u.paginator={current:1,per_page:10},u.qs={amount:"",tail_no:""},t.$watch(function(){return u.qs},function(e,t){c()},!0),u.loginPopup=function(){$(".login_pop").fadeIn().find("input[name='username']").focus()},u.closeLoginPopup=function(){$(".login_pop").fadeOut()},u.login=function(){if(!e){var n=login_form;if(""!=n.username.value){if(""!=n.balance.value)return isNaN(n.balance.value)?(alert("帳戶餘額格式不正確 !"),n.balance.focus(),void n.balance.select()):void $.ajax({url:i+"/login",type:"post",dataType:"json",data:$(n).serialize(),success:function(e){-1==e.error?(alert("登录成功."),$(".login_pop").fadeOut(),u.username=e.msg,n.username.value="",n.balance.value="",t.$digest()):"100"==e.error?console.log("會員已登入"):e.msg?alert(e.msg):alert("发生未知的错误.")}});n.balance.focus()}else n.username.focus()}},u.logout=function(){confirm("是否登出 ?")&&n.get(i+"/logout").then(function(e){u.username="",u.bet_orders=[],alert("登出成功.")},function(e){alert("登出失败. ("+e.status+": "+e.statusText+")")})},u.getBetOrders=function(){e||(u.username?$.ajax({url:i+"/getBetOrders",type:"post",dataType:"json",beforeSend:function(){e=!0,$(".waiting").fadeIn()},success:function(e){-1==e.error?(u.bet_orders=e.data,c(),t.$broadcast("AfterGetData"),t.$digest()):e.msg?alert(e.msg):alert("发生未知的错误.")},complete:function(){e=!1,$(".waiting").fadeOut()}}):u.loginPopup())},u.applicable=function(e){return!0},u.activityApplying=function(t){e||$.ajax({url:i+"/activityApplying",type:"post",data:{bet_order_id:t.bet_order_id},dataType:"json",success:function(e){-1==e.error?alert("申请成功."):e.msg?alert(e.msg):alert("发生未知的错误.")}})}}]),t.controller("SearchFormCtrl",["$scope","$interval",function(e,t){var n,o=this;function r(){--o.countdown_sec<=0&&i()}function a(e){o.countdown_sec=e||600,n=t(r,1e3)}function i(){o.countdown_sec=0,n&&t.cancel(n)}if(o.countdown_sec=0,e.$on("AfterGetData",function(e){a()}),e.$on("$destroy",function(e){i()}),"undefined"!=typeof Storage){var u=localStorage.getItem("countdown_time");if(u){var c=new Date;if((u=parseInt(u,10))>c.getTime())a(parseInt((u-c.getTime())/1e3,10))}}window.onbeforeunload=function(){if("undefined"!=typeof Storage&&o.countdown_sec){var e=new Date;e.setTime(e.getTime()+1e3*o.countdown_sec),localStorage.setItem("countdown_time",e.getTime())}}}])}();