!function(){var e=!1;$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},beforeSend:function(){e=!0},error:function(e){"419"==e.status?confirm("Session 已失效，请重新整理页面.")&&location.reload():alert("发生错误.")},complete:function(t,n){e=!1}});var t=angular.module("jsApp",["ui.bootstrap"]);t.config(["$interpolateProvider",function(e){e.startSymbol("{*"),e.endSymbol("*}")}]),t.filter("offset",function(){return function(e,t){return t=parseInt(t,10),e.slice(t)}}),t.filter("tailNo",function(){return function(e,t){if(""==t)return e;for(var n=[],o=0,r=e.length,a=new RegExp(t+"$");o<r;o++){var i=e[o];a.test(i.bet_order_id)&&n.push(i)}return n}}),t.filter("amountGreaterThan",function(){return function(e,t){if(isNaN(t)||""==t)return e;for(var n=[],o=0,r=e.length;o<r;o++){var a=e[o];a.bet_amount>=t&&n.push(a)}return n}}),t.controller("BodyCtrl",["$scope","$http","$interval","tailNoFilter","amountGreaterThanFilter","username","BASE_URI",function(t,n,o,r,a,i,u){var s,c=this;function l(){--c.countdown_sec<=0&&(c.countdown_sec=0,s&&o.cancel(s))}function f(e){c.countdown_sec=e||600,s=o(l,1e3)}if(c.username=i,c.bet_orders=[],c.filtered_bet_orders=[],c.paginator={current:1,per_page:10},c.qs={amount:"",tail_no:""},c.countdown_sec=0,"undefined"!=typeof Storage){var d=localStorage.getItem("countdown_time");if(d){var p=new Date;if((d=parseInt(d,10))>p.getTime())f(parseInt((d-p.getTime())/1e3,10))}}function g(){var e=r(c.bet_orders,c.qs.tail_no);e=a(e,c.qs.amount),c.filtered_bet_orders=e}window.onbeforeunload=function(){if("undefined"!=typeof Storage&&c.countdown_sec){var e=new Date;e.setTime(e.getTime()+1e3*c.countdown_sec),localStorage.setItem("countdown_time",e.getTime())}},t.$watch(function(){return c.qs},function(e,t){g()},!0),c.loginPopup=function(){$(".login_pop").fadeIn().find("input[name='username']").focus()},c.closeLoginPopup=function(){$(".login_pop").fadeOut()},c.login=function(){if(!e){var n=login_form;if(""!=n.username.value){if(""!=n.balance.value)return isNaN(n.balance.value)?(alert("帳戶餘額格式不正確 !"),n.balance.focus(),void n.balance.select()):void $.ajax({url:u+"/login",type:"post",dataType:"json",data:$(n).serialize(),success:function(e){-1==e.error?(alert("登录成功."),$(".login_pop").fadeOut(),c.username=e.msg,n.username.value="",n.balance.value="",t.$digest()):"100"==e.error?console.log("會員已登入"):e.msg?alert(e.msg):alert("发生未知的错误.")}});n.balance.focus()}else n.username.focus()}},c.logout=function(){confirm("是否登出 ?")&&n.get(u+"/logout").then(function(e){c.username="",c.bet_orders=[],alert("登出成功.")},function(e){alert("登出失败. ("+e.status+": "+e.statusText+")")})},c.getBetOrders=function(){e||(c.username?$.ajax({url:u+"/getBetOrders",type:"post",dataType:"json",beforeSend:function(){e=!0,$(".waiting").fadeIn()},success:function(e){-1==e.error?(c.bet_orders=e.data,g(),f(),t.$digest()):e.msg?alert(e.msg):alert("发生未知的错误.")},complete:function(){e=!1,$(".waiting").fadeOut()}}):c.loginPopup())},c.applicable=function(e){return!0},c.activityApplying=function(t){e||$.ajax({url:u+"/activityApplying",type:"post",data:{bet_order_id:t.bet_order_id},dataType:"json",success:function(e){-1==e.error?alert("申请成功."):e.msg?alert(e.msg):alert("发生未知的错误.")}})}}])}();