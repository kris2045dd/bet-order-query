!function(){var t=!1;$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},beforeSend:function(){t=!0},error:function(t){"419"==t.status?confirm("Session 已失效，请重新整理页面.")&&location.reload():alert("网络连线错误.")},complete:function(e,n){t=!1}});var e=angular.module("jsApp",["ui.bootstrap"]);function n(t,e){var n=[],r={activity1:new function(){this.isMatch=function(t,e){return"BB电子"==t.platform&&(!(t.bet_amount<1)&&(reg=new RegExp(e.split("|")[0]+"$"),!!reg.test(t.bet_order_id)))},this.getBonus=function(t,e){var n,r=e.split("|");return(n=t.bet_amount*r[1])>r[2]&&(n=r[2]),n}},activity2:new function(){this.isMatch=function(t,e){return"BB电子"!=t.platform&&"BBII电子"!=t.platform&&-1!=t.platform.indexOf("电子")&&(!(t.bet_amount<1)&&(!(t.payout_amount<=0)&&t.payout_amount/t.bet_amount>=e.split("|")[0]))},this.getBonus=function(t,e){var n,r=e.split("|");return(n=t.bet_amount*r[1])>r[2]&&(n=r[2]),n}},activity3:new function(){this.isMatch=function(t,e){return("开元棋牌"==t.platform||"BB棋牌"==t.platform||"易游棋牌"==t.platform)&&("三公"!=t.game_name&&"森林舞会"!=t.game_name&&"金鲨银鲨"!=t.game_name&&"奔驰宝马"!=t.game_name&&(!(t.bet_amount<1)&&(!(t.payout_amount<=0)&&t.payout_amount/t.bet_amount>=e.split("|")[0])))},this.getBonus=function(t,e){var n,r=e.split("|");return(n=t.bet_amount*r[1])>r[2]&&(n=r[2]),n}},activity4:new function(){this.isMatch=function(t,e){return("BB捕鱼大师"==t.platform||"BB捕鱼达人"==t.platform)&&(!(t.bet_amount<1)&&(!(t.payout_amount<=0)&&t.payout_amount>=parseInt(e.split("|")[0],10)))},this.getBonus=function(t,e){return""}},activity5:new function(){this.isMatch=function(t,e){return("BB电子"==t.platform||"BBII电子"==t.platform)&&(!(t.bet_amount<1)&&(!(t.payout_amount<=0)&&t.payout_amount>=parseInt(e.split("|")[0],10)))},this.getBonus=function(t,e){var n=e.split("|");return n[1]}}};t.get(e+"/getActivities").then(function(t){n=t.data.data}),this.markMatched=function(t){for(var e=0,o=n.length;e<o;e++){var a=r["activity"+n[e].activity_id];if(a){var i=0;for(j_len=n[e].rules.length;i<j_len;i++)if(a.isMatch(t,n[e].rules[i])){var u=a.getBonus(t,n[e].rules[i]);return t.matched=n[e].activity_id,void(t.bonus=u?parseFloat(parseFloat(u).toFixed(2)):"")}}}t.matched=0,t.bonus=""}}function r(e,n,r,o,a,i,u,s,c,l,f){var m=this;function d(){var t=i(m.bet_orders,m.qs.matched);t=u(t,m.qs.target_date),t=o(t,m.qs.tail_no),t=r(t,m.qs.platform),t=a(t,m.qs.amount),"all"==m.qs.matched&&(t=s(t,m.order_by.column,m.order_by.reverse)),m.filtered_bet_orders=t}function p(t){$(".waiting p").html(t),$(".waiting").fadeIn()}function g(){$(".waiting").fadeOut()}m.username=l,m.bet_orders=[],m.filtered_bet_orders=[],m.applied_bet_orders=[],m.msg=l?2:1,m.progress_msg="",m.paginator={current:1,per_page:10},m.qs={platform:"",amount:"",tail_no:"",matched:"",target_date:""},m.target_date_options=[{label:"所有时间",val:""},{label:moment().format("YYYY-MM-DD"),val:moment().format("YYYY-MM-DD")},{label:moment().subtract(1,"days").format("YYYY-MM-DD"),val:moment().subtract(1,"days").format("YYYY-MM-DD")}],m.order_by={column:"bonus",reverse:!0},e.$watch(function(){return m.qs},function(t,e){d()},!0),m.loginPopup=function(){$(".login_pop").fadeIn().find("input[name='username']").focus()},m.closeLoginPopup=function(){$(".login_pop").fadeOut()},m.login=function(){if(!t){var n=login_form;if(""!=n.username.value){if(""!=n.balance.value)return isNaN(n.balance.value)?(alert("帳戶餘額格式不正確 !"),n.balance.focus(),void n.balance.select()):void $.ajax({url:f+"/login",type:"post",dataType:"json",data:$(n).serialize(),beforeSend:function(){t=!0,p("登录中...")},success:function(t){-1==t.error||100==t.error?(alert("登录成功."),m.closeLoginPopup(),m.username=t.msg,m.msg=2,n.username.value="",n.balance.value="",e.$broadcast("afterLogin",m.username),e.$digest()):t.msg?alert(t.msg):alert("发生未知的错误.")},complete:function(){g(),t=!1}});n.balance.focus()}else n.username.focus()}},m.logout=function(){confirm("是否登出 ?")&&n.get(f+"/logout").then(function(t){var n=m.username;m.username="",m.bet_orders=m.filtered_bet_orders=[],m.msg=1,e.$broadcast("afterLogout",n),alert("登出成功.")},function(t){alert("登出失败. ("+t.status+": "+t.statusText+")")})},m.getBetOrders=function(){t||(m.username?$.ajax({url:f+"/getBetOrders",type:"post",dataType:"json",beforeSend:function(){t=!0,p("注单数据获取中，请耐心等待...")},success:function(t){-1==t.error?(m.bet_orders=t.data,m.msg=t.data.length?0:3,function(){for(var t=0,e=m.bet_orders.length;t<e;t++)c.markMatched(m.bet_orders[t])}(),d(),e.$broadcast("afterGettingData"),e.$digest()):t.msg?alert(t.msg):alert("发生未知的错误.")},complete:function(){g(),t=!1}}):m.loginPopup())},m.applicable=function(t){return!!t.matched},m.activityApplying=function(n){t||$.ajax({url:f+"/activityApplying",type:"post",data:{bet_order_id:n.bet_order_id},dataType:"json",beforeSend:function(){t=!0,p("申请办理中，请耐心等待...")},success:function(t){-1==t.error?alert("申请成功."):t.msg?alert(t.msg):alert("发生未知的错误."),""!==t.data&&($.extend(n,t.data),e.$digest())},complete:function(){g(),t=!1}})},m.showMemo=function(t){alert(t)},m.queryProgress=function(){t||(m.username?$.ajax({url:f+"/queryProgress",type:"post",dataType:"json",beforeSend:function(){t=!0,p("进度查询中，请耐心等待...")},success:function(t){-1==t.error?(m.applied_bet_orders=t.data,m.progress_msg=t.data.length?"":"no data",function(){if(!m.applied_bet_orders)return;for(var t=0,e=m.bet_orders.length;t<e;t++)for(var n,r=m.bet_orders[t],o=0,a=m.applied_bet_orders.length;o<a;o++)n=m.applied_bet_orders[o],r.bet_order_id==n.bet_order_id&&$.extend(r,{deposited:n.deposited,memo:n.memo})}(),e.$digest(),$(".progress_pop").fadeIn()):t.msg?alert(t.msg):alert("发生未知的错误.")},complete:function(){g(),t=!1}}):m.loginPopup())},m.closeProgressPopup=function(){$(".progress_pop").fadeOut()}}e.config(["$interpolateProvider","$compileProvider",function(t,e){t.startSymbol("{*"),t.endSymbol("*}"),e.commentDirectivesEnabled(!1),e.cssClassDirectivesEnabled(!1)}]),e.filter("offset",function(){return function(t,e){return e=parseInt(e,10),t.slice(e)}}),e.filter("platform",function(){return function(t,e){if(""==e)return t;for(var n=[],r=0,o=t.length;r<o;r++){var a=t[r];a.platform==e&&n.push(a)}return n}}),e.filter("tailNo",function(){return function(t,e){if(""==e)return t;for(var n=[],r=0,o=t.length,a=new RegExp(e+"$");r<o;r++){var i=t[r];a.test(i.bet_order_id)&&n.push(i)}return n}}),e.filter("amountGreaterThan",function(){return function(t,e){if(isNaN(e)||""==e)return t;var n=[],r=0,o=t.length;for(e=parseFloat(e);r<o;r++){var a=t[r];parseFloat(a.bet_amount)>=e&&n.push(a)}return n}}),e.filter("matchedOnly",function(){return function(t,e){if(""===e)return t;for(var n=[],r=0,o=t.length;r<o;r++){var a=t[r];a.matched&&("all"==e?n.push(a):a.matched==e&&n.push(a))}return n}}),e.filter("targetDate",function(){return function(t,e){if(""===e.val)return t;for(var n=[],r=0,o=t.length,a=new RegExp("^"+e.val);r<o;r++){var i=t[r];a.test(i.bet_time)&&n.push(i)}return n}}),e.filter("appliedStatus",function(){return function(t){switch(t+""){case"0":return"进度查询";case"1":return"已派彩";case"2":return"拒绝";default:return"一键办理"}}}),e.filter("depositedStatus",function(){return function(t){switch(t+""){case"1":return"已派彩";case"2":return"拒绝";default:return"申请中"}}}),e.service("activityService",n),n.$inject=["$http","BASE_URI"],e.controller("BodyCtrl",r),r.$inject=["$scope","$http","platformFilter","tailNoFilter","amountGreaterThanFilter","matchedOnlyFilter","targetDateFilter","orderByFilter","activityService","username","BASE_URI"],e.controller("SearchFormCtrl",["$scope","username",function(t,e){var n,r=this,o=e;function a(e){r.countdown_sec=e||600,n&&clearInterval(n),n=setInterval(function(){--r.countdown_sec<=0&&i(),t.$digest()},1e3)}function i(){r.countdown_sec=0,n&&clearInterval(n)}function u(){return"countdown_time:"+o}function s(){if("undefined"!=typeof Storage){var t=localStorage.getItem(u());if(t){var e=new Date;if((t=parseInt(t,10))>e.getTime())a(parseInt((t-e.getTime())/1e3,10))}}}r.countdown_sec=0,r.toggleSearchBet=function(){$(".search_bet").toggleClass("showSB")},t.$on("afterLogin",function(t,e){o=e,s()}),t.$on("afterLogout",function(t,e){i()}),t.$on("afterGettingData",function(t){a(),function(){if("undefined"!=typeof Storage&&r.countdown_sec){var t=new Date;t.setTime(t.getTime()+1e3*r.countdown_sec),localStorage.setItem(u(),t.getTime())}}()}),t.$on("$destroy",function(t){i()}),s()}])}();